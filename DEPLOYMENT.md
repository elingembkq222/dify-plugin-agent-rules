# Dify Agent Rules Plugin 部署指南

## 部署步骤

### 1. 准备环境

确保您的 Dify 环境已安装并正常运行。

### 2. 安装插件

1. 将插件目录复制到 Dify 的插件目录中
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

### 3. 配置插件

在 Dify 环境中配置以下环境变量：

- `RULE_DB_URL`: 规则数据库 URL（默认: sqlite:///rule_engine.db）
- `BUSINESS_DB_URL`: 业务数据库 URL（可选）
- `LLM_MODEL`: 用于查询解析的 LLM 模型（默认: gpt-4o）

### 4. 启动插件

在 Dify 中启用插件，并确保插件正常运行。

### 5. 使用前端 UI

1. 启动本地服务器：
   ```bash
   cd web
   python3 -m http.server 8080
   ```
2. 在浏览器中访问：http://localhost:8080

## 功能说明

### 规则列表

- 查看所有可用的规则集
- 按目标类型过滤规则
- 查看规则详情

### 添加规则

- 创建新的规则集
- 编辑现有规则集
- 支持复杂的规则表达式

### 验证规则

- 测试规则集是否正常工作
- 查看验证结果和违规详情

### 生成规则

- 使用自然语言描述生成规则
- 基于上下文数据生成规则
- 将生成的规则添加到规则集

## 注意事项

1. 前端 UI 目前使用模拟数据，实际部署时需要配置正确的 API 端点
2. 规则数据库会自动创建，但建议在生产环境中使用 PostgreSQL
3. 确保 LLM 模型配置正确，以便自然语言查询解析功能正常工作

## 故障排除

1. 如果插件无法启动，检查依赖是否正确安装
2. 如果前端无法加载数据，检查 API 端点配置
3. 如果规则验证失败，检查规则表达式格式是否正确